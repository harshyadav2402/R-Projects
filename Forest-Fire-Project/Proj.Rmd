---
title: "Business Analytics Project- Forest Fire Data"
author: "Harsh Yadav (hy1217), Nitish Dabas(nd1292), Kush Shah ()"
date: "11/22/2017"
output: rmarkdown::github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
fire <- read.csv("C:/Users/Harsh Yadav/Downloads/forestfires.csv", header=TRUE, stringsAsFactors=FALSE)
str(fire)
```

##The data has been stored in a dataframe named fire and the str function shows that there are 517 observations and 13 variables in our dataset. The description of each column is as follows:

   1. X - x-axis spatial coordinate within the Montesinho park map: 1 to 9
   2. Y - y-axis spatial coordinate within the Montesinho park map: 2 to 9
   3. month - month of the year: "jan" to "dec" 
   4. day - day of the week: "mon" to "sun"
   5. FFMC - FFMC index from the FWI system: 18.7 to 96.20
   6. DMC - DMC index from the FWI system: 1.1 to 291.3 
   7. DC - DC index from the FWI system: 7.9 to 860.6 
   8. ISI - ISI index from the FWI system: 0.0 to 56.10
   9. temp - temperature in Celsius degrees: 2.2 to 33.30
   10. RH - relative humidity in %: 15.0 to 100
   11. wind - wind speed in km/h: 0.40 to 9.40 
   12. rain - outside rain in mm/m2 : 0.0 to 6.4 
   13. area - the burned area of the forest (in hectares): 0.00 to 1090.84 

```{r}
sum(is.na(fire))
nacols <- function(fire) {
    colnames(fire)[unlist(lapply(fire, function(x) any(is.na(x))))]
}

```

##There are no NaN or NULL values in our dataset.

```{r}
summary(fire)
```

##The above function represents the summary of each of the feature of our dataset representing their min, max, quartile values.

```{r}
library(GGally)
ggcorr(fire[,3:13], palette = "RdBu", label = TRUE)
```

##The correlation represented above shows the relationship between different feartures of our dataset. We can see that DC and DMC values are most strongly positively correlated to each other and temperature is strongly negatively correlated to RH value.

##Fine Fuel Moisture Code - FFMC
##This is a numerical rating of the moisture content of surface litter and other cured fine fuels. It shows the relative ease of ignition and flammability of fine fuels. The moisture content of fine fuels is very sensitive to the weather. Even a day of rain, or of fine and windy weather, will significantly affect the FFMC rating. The system uses a time lag of two-thirds of a day to accurately measure the moisture content in fine fuels. The FFMC rating is on a scale of 0 to 99. Any figure above 70 is high, and above 90 is extreme.

```{r}
range(fire$FFMC)
```

##Here we can see that our dataset has values of FFMC between 18.7 to 96.2 which is between the range of 0 to 99 as defined above for the FFMC index.

```{r}

library(ggplot2)
boxplot(fire$FFMC)
```

##The first table shows that the FFMC index has values between 

##This box plot shows that most of the almost all the data in our dataset involves the FFMC index that is above 70 and comes in the high category and thus is quite dangerous for the fire to occur. Also, we can see that most of the values are near 90 and above which indicates that there are extreme chances of forest fore to occur.

```{r}
ggplot(data = fire, aes( x = wind , y = temp, fill = FFMC ) ) +    # print bar chart
  geom_bar( stat = 'identity', position = 'dodge' )
```

##This plot shows that for lower values of wind and higher values of temperature the FFMC values very high and thus there is very high chances of fire when the wind speed is low and the temperature is high.

##Duff Moisture Code - DMC

##DMC is a numerical rating of the average moisture content of loosely compacted organic layers of moderate depth. The code indicates the depth that fire will burn in moderate duff layers and medium size woody material. Duff layers take longer than surface fuels to dry out but weather conditions over the past couple of weeks will significantly affect the DMC. The system applies a time lag of 12 days to calculate the DMC. A DMC rating of more than 30 is dry, and above 40 indicates that intensive burning will occur in the duff and medium fuels. Burning off operations should not be carried out when the DMC rating is above 40.

```{r}
library(ggplot2)
boxplot(fire$DMC)
```

##The Boxplot for DMC index indicates that most of the values lie between 60 to 150 which are above 40 and thus, we can infer that there is very high chance of fire occuring due to such high values of DMC as described in the description above.

##Drought Code - DC

##The DC is a numerical rating of the moisture content of deep, compact, organic layers. It is a useful indicator of seasonal drought and shows the likelihood of fire involving the deep duff layers and large logs. A long period of dry weather (the system uses 52 days) is needed to dry out these fuels and affect the Drought Code. A DC rating of 200 is high, and 300 or more is extreme indicating that fire will involve deep sub-surface and heavy fuels. Burning off should not be permitted when the DC rating is above 300.

```{r}
library(ggplot2)
boxplot(fire$DC)
```

##The above boxplot for the DC index shows that most of the values lie between 400 to 700 which are extreme conditions for fire to occur and in these situations burning off is not allowed as they may facilitate forest fires. Further, there exists outliers which are shown in the boxplot with a circular shape.

```{r}
library(dplyr)
fire$DC_Cat <- cut(fire$DC, 
                       breaks = c(-Inf, 100, 200, 300, Inf), 
                       labels = c("Low", "Medium", "High", "Extreme"), 
                       right = FALSE)

ggplot(data=fire, aes(x=fire$DC)) + geom_histogram()
```

##From the histogram we can view that most of the values of DC index are very high and thus there are extreme chnces for the fire to occur.

```{r}
plot(DC ~ DMC, fire, col=fire$DMC)
```

##From the above scatter plot we can see that for high values of DC index the value of the DMC index is also high. As both DC and DMC index depend on moisture content of organic layers, therefore this kind of relationship exists betwen them where if one increases then other also increases. For higher values of DMC and DC index there are more extreme chances of fore to occur.

##Initial Spread Index - ISI

##This indicates the rate fire will spread in its early stages. It is calculated from the FFMC rating and the wind factor. The open-ended ISI scale starts at zero and a rating of 10 indicates high rate of spread shortly after ignition. A rating of 16 or more indicates extremely rapid rate of spread.

```{r}
boxplot(fire$ISI)
```

##From the boxplot of the ISI index we can see that most of the values of this index are from 5 to 10, where 10 indicates high rate of spread shortly after ignition. Also, there are values above 10, which indicate severe spread of fire.

```{r}
library(dplyr)
library(tidyr)

fire$ISI_Cat <- cut(fire$ISI, 
                       breaks = c(-Inf, 3, 9, 16, Inf), 
                       labels = c("Low", "Medium", "High", "Extreme"), 
                       right = FALSE)

mycolors = c('green','yellow','orange','red')
plot(fire$FFMC, fire$wind, pch = 16, col = mycolors[fire$ISI_Cat])
legend("topleft", legend=levels(fire$ISI_Cat), pch=16, col=unique(mycolors))
```

##From the above graph we infer that for higher values of FFMC index the values of ISI increase. Thus, for extreme values of FFMC we obtain extreme values of ISI index which show that there are extreme chang=ces of fire and also there are extreme chances that the fore will spread rapidly.

##Relative humidity - RH

##Relative humidity (RH) is the ratio of the partial pressure of water vapor to the equilibrium vapor pressure of water at a given temperature. Relative humidity depends on temperature and the pressure of the system of interest. It requires less water vapor to attain high relative humidity at low temperatures; more water vapor is required to attain high relative humidity in warm or hot air.

```{r}
boxplot(fire$RH)
```

##This plot represents that most of the Relative Humidity values lie between 30 to 55, which are ideal RH values. The values near 100 represent very high humidity level.

```{r}
fire$RH_Cat <- cut(fire$RH, 
                       breaks = c(-Inf, 25, 50, 75, Inf), 
                       labels = c("Low", "Medium", "High", "Extreme"), 
                       right = FALSE)

mycolors = c('red','yellow','green','blue')
plot(fire$temp, fire$rain, pch = 16, col = mycolors[fire$RH_Cat])
legend("topleft", legend=levels(fire$RH_Cat), pch=16, col=unique(mycolors))
```

##As most of the values for the Rain column in our dataset are 0, so the above graph does not represent ideal visual of variance og RH with rain and Temperature. But, we can see that for high values of temperature the humidity decreases and for less values of temperature the humidity level is quite high.

```{r}
hist(fire$area)
rug(fire$area)
```
##The above histogram for the area that was affected by fire represents that most of the fire that occured was very less and did not spread much. But, in some cases we can see that the fire occured covering major areas.

```{r}
fire_new <- fire[fire$area>0,]
fire_new$area_Cat <- cut(fire_new$area, 
                       breaks = c(0, 10, 30, 70, Inf), 
                       labels = c("Low", "Medium", "High", "Extreme"), 
                       right = FALSE)

ggplot(fire_new, aes(x=wind, y=temp, fill=area_Cat))+
  geom_bar(position="dodge", stat="identity")
```

##For this plot first a new dataset has been created ignoring all the 0 values in the area column. Further the variable are has been classified as low, medium, high and extreme based on the area in which the fire occured. Therefore, form the visualization we can see that extreme fire occur for moderate values of wind, but high values of temperature. So, it can be infered that temperature is a major factor for occurance of fire.

```{r}
ggplot(fire_new, aes(x=rain, y=temp, fill=area_Cat))+
  geom_bar(position="dodge", stat="identity")
```

##From this plot we can infer that most of the forest fore occur when there is no rain, thus rin also, plays an important factor in the occurance of forest fires.

```{r}
ggplot(fire_new, aes(x=FFMC, y=temp, fill=area_Cat))+
  geom_bar(position="dodge", stat="identity")
```

##This plot shows that most of the forest fire occur when the value of FFMC and temperature are both high. As we know that FFMC is a numerical rating of the moisture content of surface litter and other cured fine fuels. It shows the relative ease of ignition and flammability of fine fuels for a higher value.

```{r}
ggplot(fire_new, aes(x=month, y=temp, fill=area_Cat))+
  geom_bar(position="dodge", stat="identity")
```

#This graph shows that most of the extreme forest fire occur during occur during the month of June, July, August and September when the temperature is high, so it facilitates occurance of fire.

#Predictive Analysis

##Regression Tree Algorithm

```{r}
fire_t <- read.csv("C:/Users/Harsh Yadav/Downloads/forestfires.csv", header=TRUE, stringsAsFactors=FALSE)
```
##Here we have loaded the dataset fromthe csv file to a dataframe named fire_t, which we are going to use for our predictive analysis using regression tree algorithm.

```{r}
library(plyr)
fire_t$day <- revalue(fire_t$day, c("sun"=1, "mon"=2, "tue"=3, "wed"=4, "thu"=5, "fri"=6, "sat"=7))
fire_t$month <- revalue(fire_t$month, c("jan"=1, "feb"=2, "mar"=3, "apr"=4, "may"=5, "jun"=6, "jul"=7, "aug"=8, "sep"=9, "oct"=10, "nov"=11, "dec"=12))

set.seed(415)

data <- sample(2,nrow(fire_t),replace=TRUE,prob=c(0.7,0.3))
trainData <- fire_t[data==1,]
testData <- fire_t[data==2,]
```

#Then we have used the plyr library to convert the day column in our dataframe from string to numerical values and converting the month column from string to numerical values from 1 to 12. We have done this in order to avaoid any coersions that introduce NA's in our model.
#Further we have set the seed to 415, and then dive=ided our data into training and testing datasets named trainData and testData respectively. We have performed training of our model using the trainData dataset and will be testing it using the testData dataset.

```{r}
library(tree)
pstree <- tree(area ~., data=trainData, mincut=1) 
pstree
```

#We have now used the tree tree library to train the modlel named pstree which is our regression tree model with a mincut of 1. Then we have shown the traind model. The model shows that the feature named temp is the most important feature. It represents the temperature when the fire has occured or not. From this tree we can esily see that it is not a good model for making predictions of occurance of forest fires as it just depends on one feature which is the temperature and does not depend on other features like FFMC index, humidity, rain, ISI, etc, which also play an important role in the occurance of forest fires. So, this model is not a good predicctive model. Apart from this it has high deviance values which will again not help us in predicting good results of our target variable area.
```{r}
plot(pstree, col=8)
text(pstree, digits=2)
```

##Here we have represented the above tree and the vertical lines represent the deviance in our obtained results. The tree represents high deviance and only depends on one feature. So we will not consider it for our further analysis of making prediction of fire areas.

```{r}
library(tree)
pstree <- tree(area ~., data=trainData, mincut=5) 
pstree
```

# Here we have used a different value of mincut to see if we have any improvements in our results. But, we have obtained higher values of deviance for the value of mincut as 5. So we consider not using this model.

```{r}
set.seed(2)
cvpst <- cv.tree(pstree, K=10)
cvpst$size
cvpst$dev

```

#Now using cross validation to determine the best case for our analysis using the tree algorithm we can see that the least deviance occurs for the value of micut as 1 as we saw above. This is not a good result, so we now plan to use other predictive algorithm to for our predictive analysis.


#Random Forest Algorithm

```{r}
fire_rf <- read.csv("C:/Users/Harsh Yadav/Downloads/forestfires.csv", header=TRUE, stringsAsFactors=FALSE)
```

#Here we have again loaded our dataset into a dataset named fire_rf for our predictive modelling using the Random forest algorithm.

```{r}
library(plyr)
fire_rf$area_category <- cut(fire_rf$area, breaks=c(-1, 10, 25, 50, 100, 150, 200, 250, Inf), labels=c(1,2,3,4,5,6,7,8))
fire_rf$day <- revalue(fire_rf$day, c("sun"=1, "mon"=2, "tue"=3, "wed"=4, "thu"=5, "fri"=6, "sat"=7))
fire_rf$month <- revalue(fire_rf$month, c("jan"=1, "feb"=2, "mar"=3, "apr"=4, "may"=5, "jun"=6, "jul"=7, "aug"=8, "sep"=9, "oct"=10, "nov"=11, "dec"=12))
```

#Then we have used the plyr library to first define categories for our target variable area and have named it as area_category, so that we can use random forest on categorical data. We have divided the variable area into 8 discrete categories that are as follows:
1. Areas from 0 to 10 hectares: Almost negligible fire
2. Areas from 10 to 25 hectares: Small fire
3. Areas from 25 to 50 hectares: Moderate fire
4. Areas from 50 to 100 hectares: Lagre fire
5. Areas from 100 to 150 hectares: Big fire
6. Areas from 150 to 200 hectares: Huge fire
7. Areas from 200 to 250 hectares: Extreme fire
8. Areas above 250 hectares: Uncontrollable fire

#We have assigned a number to each category for our predictive analysis from 1 to 8 respectively.

#Then we convert the day column in our dataframe from string to numerical values and converting the month column from string to numerical values from 1 to 12. We have done this in order to avaoid any coersions that introduce NA's in our model.


```{r}
set.seed(415)
data <- sample(2,nrow(fire_rf),replace=TRUE,prob=c(0.7,0.3))
trainData <- fire_rf[data==1,]
testData <- fire_rf[data==2,]
```

#Further we have set the seed to 415, and then dive=ided our data into training and testing datasets named trainData and testData respectively. We have performed training of our model using the trainData dataset and will be testing it using the testData dataset.

```{r}
library(randomForest)
fit <- randomForest(area_category ~., data=trainData, importance=TRUE, ntree=100)
```

#Here, we have created a model named fit, whci will be trained using the Random Forest Algorithm on our categorical target variable named area_category based on all the predictive variables. The data used for training is the trainData dataset that is defined above. We have used 200 trees for our random forest algorithm analysis.

```{r}
varImpPlot(fit)
```

#Here we can see the plot for our trained Random Forest model named fit. We can see the Mean Decrease Accuracy and Mean Decrease Gini for each of our predictor variables. From the plot we can observe that temperature is the most important feature followed by ISI and DMC index for computing our accuracy for the model. We can also see that in computing the Gini value.The mean decrease in Gini coefficient is a measure of how each variable contributes to the homogeneity of the nodes and leaves in the resulting random forest. Each time a particular variable is used to split a node, the Gini coefficient for the child nodes are calculated and compared to that of the original node. SO we can see that temperature is again most imporant in computing the Gini value.

```{r}
Pred<-predict(fit,newdata=testData)
conf <- table(Pred, testData$area_category)
```

#Here we have stored the predicted results obtained from our trained model which we ran on the testData. The predicted values are stored in variable named Pred. Then, we have defined a table named conf that stores the actual vales and the Predicted values in a table, so that we can determone the accuracy and other parameters of our model.

```{r}
library(e1071)
library(caret)

confusionMatrix(conf)
```

#Here are the results that have been obtained from our random forest algorithm. We have used the confusion matrix to obtain the results. We can observe that we have obtained an accuracy of 94.27 %, so we are quite accurately able to predict the extent of fire that would occur given the data of rain, temperature, FFMC, coordinates (X and Y), ISI, humidity, etc. 
#Additionally we can see the calsses to which the predicted results belong to. So, we can observe that maximum results belong to the 1st class, that predicted almost negligible fire. Further, the sensitivity, specificity and other parameters for all the classes have been shown. We have taken 95% confidence interval for our analysis and most of our results are within it.
#The no information error rate is the error rate when the input and output are independent. So, for our case the value id very low, which indicates good modelling of our data.
#The p-value tells us the probability of the under the null hypothesis. A small p-value (typically ??? 0.05) indicates strong evidence against the null hypothesis, so we reject the null hypothesis.
#The Kappa value is a metric that compares an Observed Accuracy with an Expected Accuracy (random chance). The kappa statistic is used not only to evaluate a single classifier, but also to evaluate classifiers amongst themselves. In essence, the kappa statistic is a measure of how closely the instances classified by the machine learning classifier matched the data labeled as ground truth, controlling for the accuracy of a random classifier as measured by the expected accuracy.















